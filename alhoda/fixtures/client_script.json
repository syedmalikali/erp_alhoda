[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2023-12-04 10:31:31.971444",
  "module": "Alhoda",
  "name": "Sales Person in Quotation",
  "script": "frappe.ui.form.on('Quotation', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n customer_name : function(frm){\n            // Triggered when the customer field is changed\n        // Get the selected customer's salesperson\n         frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Customer',\n                filters: {\n                    name: frm.doc.party_name, // Get Sales Teams related to this Customer\n                },\n                fields: ['sales_team.sales_person'],\n            },\n            callback: function(r) {\n                if (r.message && r.message.length > 0) {\n                    // Assuming there can be multiple Sales Team entries for a customer\n                    // You can handle multiple entries as needed\n                    const salesPerson = r.message[0].sales_person;\n                    // Do something with the salesPerson value, e.g., display it in a field\n                    frm.set_value('custom_sales_person', salesPerson);\n                }\n            }\n        });\n    \n        \n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2023-12-06 20:30:25.491570",
  "module": "Alhoda",
  "name": "Item List View",
  "script": "frappe.listview_settings['Item'] = { \r\n    add_fields: [\"custom_item_name_arabic\"],\r\n\trefresh: function(listview) {\r\n\t    \r\n        console.log('malik')\r\n\t\t\r\n\t\r\n\t} ,\r\n  \r\n\r\n};",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2023-12-11 08:51:27.623999",
  "module": "Alhoda",
  "name": "Warehouse Restriction",
  "script": "frappe.ui.form.on('Sales Order', {\n  \n   refresh(frm) {\n        chkWarehouse(frm);\n    },\n    cost_center(frm) {\n        chkWarehouse(frm);\n    \n    }\n});\n\nfunction chkWarehouse(frm) {\n  \n    frm.set_query('warehouse', 'items', function (doc, cdt, cdn) {\n        var chk = frm.doc.__unsaved ? frm.doc.cost_center : '';\n        var filters = erpnext.queries.warehouse(frm.doc);\n        if (chk === undefined) {\n                frappe.msgprint('Please specify: Branch. It is needed to fetch Item Details.')\n    }\n\n        var d = locals[cdt][cdn];\n        if (chk) {\n            $.extend(filters, {\n                \"query\": \"erpnext.controllers.queries.warehouse_query\",\n                \"filters\": [\n                    [\"Warehouse\", \"parent_warehouse\", \"=\", chk],\n                    [\"Bin\",\"item_code\",\"=\",d.item_code]\n                    ]\n            });\n        }        \n        return filters;\n    });\n\n    frm.set_query('set_warehouse', function (doc, cdt, cdn) {\n        \n        var d = locals[cdt][cdn];\n        return {\n            \"filters\": {\n                \"parent_warehouse\": chk,\n                \"is_group\":0\n            }\n        };\n    });\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2023-12-21 10:24:38.378987",
  "module": "Alhoda",
  "name": "warehouse Restriction Sales Invoice",
  "script": "frappe.ui.form.on('Sales Invoice', {\n   refresh(frm) {\n        chkWarehouse(frm);\n    },\n    cost_center(frm) {\n        chkWarehouse(frm);\n    \n    },\n        onload_post_render(frm){\n        \n        rem_buttons(frm)\n    },\n});\nfunction rem_buttons(frm){\n    frm.remove_custom_button('Fetch Timesheet');\n}\nfunction chkWarehouse(frm) {\n    var chk = frm.doc.__unsaved ? frm.doc.cost_center : '';\n    frm.set_query('warehouse', 'items', function (doc, cdt, cdn) {\n        var chk = frm.doc.__unsaved ? frm.doc.cost_center : '';\n        var filters = erpnext.queries.warehouse(frm.doc);\n        if (chk === undefined) {\n                frappe.msgprint('Please specify: Branch. It is needed to fetch Item Details.')\n    }\n\n        var d = locals[cdt][cdn];\n        if (chk) {\n            $.extend(filters, {\n                \"query\": \"erpnext.controllers.queries.warehouse_query\",\n                \"filters\": [\n                    [\"Warehouse\", \"parent_warehouse\", \"=\", chk],\n                    [\"Bin\",\"item_code\",\"=\",d.item_code]\n                    ]\n            });\n        }         \n        return filters;\n    });\n\n    frm.set_query('set_warehouse', function (doc, cdt, cdn) {\n        \n        var d = locals[cdt][cdn];\n        return {\n            \"filters\": {\n                \"parent_warehouse\": chk,\n                \"is_group\":0\n            }\n        };\n    });\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Delivery Note",
  "enabled": 1,
  "modified": "2023-12-21 10:20:41.484339",
  "module": "Alhoda",
  "name": "Warehouse Restriction Delivery Note",
  "script": "frappe.ui.form.on('Delivery Note', {\r\n    refresh(frm) {\r\n        chkWarehouse(frm);\r\n    },\r\n    onload_post_render(frm){\r\n        \r\n        rem_buttons(frm)\r\n    },\r\n\r\n});\r\nfunction rem_buttons(frm){\r\n    frm.remove_custom_button('Shipment', 'Create');\r\n    frm.remove_custom_button('Installation Note', 'Create');\r\n    frm.remove_custom_button('Delivery Trip', 'Create');\r\n    frm.remove_custom_button('Sales Invoice', 'Create');\r\n    frm.remove_custom_button('Stock Ledger', 'View');\r\n    frm.remove_custom_button('Accounting Ledger', 'View');\r\n    frm.remove_custom_button('Close', 'Status');\r\n}\r\nfunction chkWarehouse(frm) {\r\n   \r\n    frm.set_query('warehouse', 'items', function (doc, cdt, cdn) {\r\n        var chk = frm.doc.__unsaved ? frm.doc.cost_center : '';\r\n        var filters = erpnext.queries.warehouse(frm.doc);\r\n         var d = locals[cdt][cdn];\r\n        if (chk === undefined) {\r\n                frappe.msgprint('Please specify: Branch. It is needed to fetch Item Details.')\r\n    }\r\n        if (chk) {\r\n            $.extend(filters, {\r\n                \"query\": \"erpnext.controllers.queries.warehouse_query\",\r\n                \"filters\": [\r\n                    [\"Warehouse\", \"parent_warehouse\", \"=\", chk],\r\n                    [\"Bin\",\"item_code\",\"=\",d.item_code]\r\n                    ]\r\n            });\r\n        }\r\n       \r\n       \r\n        return filters;\r\n    });\r\n\r\n    frm.set_query('set_warehouse', function (doc, cdt, cdn) {\r\n        \r\n        var d = locals[cdt][cdn];\r\n        return {\r\n            \"filters\": {\r\n                \"parent_warehouse\": chk,\r\n                \"is_group\":0\r\n            }\r\n        };\r\n    });\r\n}\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2023-12-11 08:50:23.362957",
  "module": "Alhoda",
  "name": "Warehouse Restriction Quotation",
  "script": "frappe.ui.form.on('Quotation', {\nrefresh(frm) {\n    stock_Enquiry(frm)\n cur_frm.fields_dict.custom_cost_center.get_query = function(doc,cdt,cdn) {\n\t\treturn {\n\t\t\tfilters:[\n\t\t\t\t['is_group', '=', 0]\n\t\t\t]\n\t\t}\n\t}\n  chkWarehouse(frm);\n    \n\t},\n\tcustom_cost_center(frm) {\n        chkWarehouse(frm);\n    \n    }\n\t\n    \n\n})\n\n\n\nfunction chkWarehouse(frm) {\n  \n    frm.set_query('warehouse', 'items', function (doc, cdt, cdn) {\n        var chk = frm.doc.__unsaved ? frm.doc.custom_cost_center : '';\n        var filters = erpnext.queries.warehouse(frm.doc);\n         var d = locals[cdt][cdn];\n        if (chk === undefined) {\n                frappe.msgprint('Please specify: Branch. It is needed to fetch Item Details.')\n    }\n        if (chk) {\n            $.extend(filters, {\n                \"query\": \"erpnext.controllers.queries.warehouse_query\",\n                \"filters\": [\n                    [\"Warehouse\", \"parent_warehouse\", \"=\", chk],\n                    [\"Bin\",\"item_code\",\"=\",d.item_code]\n                    ]\n            });\n        }\n       \n        return filters;\n    });\n\n    frm.set_query('set_warehouse', function (doc, cdt, cdn) {\n        \n        var d = locals[cdt][cdn];\n        return {\n            \"filters\": {\n                \"parent_warehouse\": chk,\n                \"is_group\":0\n            }\n        };\n    });\n}\n\nfunction stock_Enquiry(frm){\n    frappe.ui.keys.on('ctrl+q', function(e) {\n  {\n  \n  { \n  const current_doc = $('.data-row.editable-row').parent().attr(\"data-name\");\n  const item_row = locals[\"Quotation Item\"][current_doc];\n  console.log(item_row)\n  frappe.call({\n  method: 'erpnext.stock.dashboard.item_dashboard.get_data',\n  args: {\n  item_code: item_row.item_code,\n  },\n  callback: function(r) {\n  if (r.message.length > 0){\n  const d = new frappe.ui.Dialog({\n  title: __('Item Balance'),\n  width: 400\n  });\n  $(`<div class=\"modal-body ui-front\">\n  <h2>${item_row.item_code}</h2>\n  <p>Choose Warehouse and click Select :</p>\n  <table class=\"table table-bordered\">\n  <thead>\n  <tr>\n  <th>Check</th>\n  <th>Warehouse</th>\n  <th>Qty</th>\n  <th>Avg.Cost</th>\n  </tr>\n  </thead>\n  <tbody>\n  </tbody>\n  </table>\n  </div>`).appendTo(d.body);\n  r.message.forEach(element => {\n  const tbody = $(d.body).find('tbody');\n  const tr = $(`\n  <tr>\n  <td><input type=\"checkbox\" class=\"check-warehouse\" data-warehouse=\"${element.warehouse}\"></td>\n  <td>${element.warehouse}</td>\n  <td>${element.actual_qty}</td>\n  <td>${element.valuation_rate }</td>\n  </tr>\n  `).appendTo(tbody)\n  tbody.find('.check-warehouse').on('change', function() {\n  $('input.check-warehouse').not(this).prop('checked', false); \n  });\n  });\n  d.set_primary_action(\"Select\", function() {\n  $(d.body).find('input:checked').each(function(i, input) {\n  frappe.model.set_value(item_row.doctype, item_row.name, 'warehouse', $(input).attr('data-warehouse'));\n  });\n  cur_frm.rec_dialog.hide();\n  cur_frm.refresh_fields();\n  });\n  cur_frm.rec_dialog = d;\n  d.show(); \n  }\n  }\n  }); \n  }\n  \n  }\n  })\n  \n\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2023-12-21 09:25:17.112588",
  "module": "Alhoda",
  "name": "Naming Series Quotation",
  "script": "frappe.ui.form.on('Quotation', {\nonload_post_render(frm){\n        frm.remove_custom_button('Opportunity', 'Get Items From');\n        \n    },\n\trefresh(frm) {\n\t\t   document.getElementsByClassName(\"form-tabs-list\")[0].style.backgroundColor = 'cadetblue';\n// \tsetTimeout(() => {\n//         console.debug(\"Removing Duplicate Button\");\n  \n//         $('a.grey-link').each(function() {\n//             // Comparing data-label instead of Button Text\n//             var id = $(this).children(':first-child').attr('data-label'); \n//             if(id == 'Print'){\n//                 $(this).remove();\n//                 return false // exit loop\n//             }\n//         });\n        \n\t    \n// \t}, 100);\n    \n\n\t},\n\n   \n})\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2023-12-15 22:56:12.032602",
  "module": "Alhoda",
  "name": "WH Restriction Stock Entry",
  "script": "frappe.ui.form.on('Stock Entry', {\n\trefresh(frm) {\n\t    frm.page.wrapper.find(\".comment-box\").css({'display':'none'});\n\t    frm.page.wrapper.find(\".new-timeline\").css({'display':'none'});\n\t    \n\t    \n\t    \n\t    var userRoles = frappe.user_roles;\n\n        // Filter roles starting with a number\n        var rolesStartingWithNumber = userRoles.filter(function(role) {\n            return /^\\d/.test(role);\n        });\n        if (rolesStartingWithNumber[0]){\n            \tfrm.set_query(\"from_warehouse\", (doc) => {\n         return {\n             filters: {\n                 \"name\": rolesStartingWithNumber[0] // whatever state is selected\n             }\n         }\n     });\n        }\n\n\t\n\t},\n\tbefore_save(frm){\n\t    if (frm.doc.owner != frappe.session.user){\n            frappe.throw(__('You cannot Save this. Only by MDR Created user'))\t    }\n\t}\n})",
  "view": "Form"
 }
]